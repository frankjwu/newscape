extends maplayout

block content
  div(id="map-canvas")

  script.
    function initialize(tweets) {
      console.log(tweets);

      var mapOptions = {
        center: new google.maps.LatLng(41.3, -72.9),
        zoom: 8,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };

      var newsMap = {};
      newsMap['Poopertrator'] = {
        center: new google.maps.LatLng(41.3, -72.9),
        radius: 30000,
        title: tweets[0].text,
        blurb: '<div id="content">'+
          '<div id="siteNotice">'+
          '</div>'+
          '<h1 id="firstHeading" class="firstHeading">Poopetrator</h1>'+
          '<div id="bodyContent">'+
          '<p><b>Poopetrator</b>, also referred to as <b>Poopgate</b>, is a ' +
          'very contentious event in Yale\'s recent history. </p>'+
          '<p>Attribution: <a href="http://www.yahoo.com">Yahoo</a></p>'+
          '</div>'+
          '</div>',
      };
      newsMap['Poopgate'] = {
        center: new google.maps.LatLng(42.3, -72.9),
        radius: 6000,
        title: 'Poopgate',
        blurb: '<div id="content">'+
          '<div id="siteNotice">'+
          '</div>'+
          '<h1 id="firstHeading" class="firstHeading">Poopgate</h1>'+
          '<div id="bodyContent">'+
          '<p><b>Poopgate</b>, also referred to as <b>the Poopetrator Incident</b>, '+
          'is a very contentious event in Yale\'s recent history. </p>'+
          '<p>Attribution: <a href="http://www.yahoo.com">Yahoo</a></p>'+
          '</div>'+
          '</div>',
      };
      newsMap['CHARLESJIN'] = {
        center: new google.maps.LatLng(41.3, -73.9),
        radius: 7000,
        title: 'CHARLESJIN',
        blurb: '<div id="content">'+
          '<div id="siteNotice">'+
          '</div>'+
          '<h1 id="firstHeading" class="firstHeading">CHARESJIN</h1>'+
          '<div id="bodyContent">'+
          '<p><b>Charles Jin</b>, is so fucking cool' +
          '<p>Attribution: <a href="http://www.yahoo.com">Yahoo</a></p>'+
          '</div>'+
          '</div>',
      };

      var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

      var minstyle = [
        {
          "featureType": "road",
          "elementType": "geometry",
          "stylers": [
            { "color": "#4d8080" },
            { "visibility": "off" }
          ]
        },{
          "featureType": "road",
          "elementType": "labels",
          "stylers": [
            { "visibility": "off" }
          ]
        },{
          "featureType": "landscape",
          "stylers": [
            { "visibility": "off" }
          ]
        },{
          "featureType": "transit",
          "stylers": [
            { "visibility": "off" }
          ]
        },{
          "featureType": "poi",
          "stylers": [
            { "visibility": "off" }
          ]
        },{
          "featureType": "road.highway",
          "stylers": [
            { "visibility": "on" },
            { "lightness": 44 }
          ]
        }
      ];
      map.setOptions({styles: minstyle});

      var infowindow = new google.maps.InfoWindow();
      // Construct the circle for each newsitem
      for (var newsItem in newsMap) {
        var circleOptions = {
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35,
          map: map,
          center: newsMap[newsItem].center,
          radius: newsMap[newsItem].radius,
        };
        newsCircle = new google.maps.Circle(circleOptions);
        createMarker(newsMap[newsItem].center, newsMap[newsItem].title, newsMap[newsItem].blurb);
      };

      function createMarker(newsCenter, newsTitle, newsBlurb){
        var marker = new google.maps.Marker({
          position: newsMap[newsItem].center,
          map: map,
          title: newsTitle,
        });
        google.maps.event.addListener(marker, 'click', function() {
          infowindow.setContent(newsBlurb);
          infowindow.open(map,marker);
        });
      }

    }
    var json = !{json};
    console.log(json);
    google.maps.event.addDomListener(window, 'load', initialize(json));
